!function(e,t,n,a,o){"use strict";var i=t.helper,s=t.tools,l=t.common,c;t.betModule=t.betModule||{};e.extend(t.betModule,{init:function(e){var t={betArea:this.betAreaInit(e.betAreaConfig),betMethod:this.betMethodInit(e.betMethodConfig),betPool:this.betPoolInit(e.betPoolConfig)};if("mixall4dg"==e.playType||"mixall"==e.playType){t.betArea.betView.initMoreOption=h;t.betArea.betView.initMoreOption()}f(t.betArea,t.betPool,t.betMethod);d(t.betArea,t.betPool,t.betMethod);m(t.betArea,t.betPool,t.betMethod);return t},betAreaInit:function(t){var a=this,o;o=n.createCom("COMS.JC.BetArea",e.extend(t,{betView:c,gameId:n.config.gameId}));return o},betMethodInit:function(e){var t,a=this;t=n.createCom("COMS.JC.BetMethod",e);return t},betPoolInit:function(e){var t=n.createCom("COMS.JC.BetPool",e);return t}});var r={render:function(){var n=this,a=this.config,o=this.betArea,l=e("#matchListTpl").html(),c=e("#oneDateMatchTpl").html(),r=e("#oneMatchTpl").html(),h=o.config.playType,f=n.cache.gameWrap,d,m,u;var p=function(t,n){var a=n.dgStatus,o=/4dg$/,s=false,l;if(i.isDgByPlayType(t))if("mixall4dg"==t){e.each(a,function(e,t){if(!!t)s=true});return s}else return!!a[t.replace(o,"")];else if("mixall"!=t){l=n.mixStatus[t];if(l&&(1==l||2==l))return true;else return false}return true};var g=function(){var i,g,C,v,M,b,S,y={attention:{},unattention:{}},O,I,B=!t.cache.betDate,T=0;i=t.cache.matchList||[];e.each(i,function(t,n){if(p(h,n)){var a=n.gameDate,o,i,l=n.isAttention?y.attention:y.unattention;if(n.isAttention)T+=1;o=+n.matchDate;i=+n.matchDate+24*60*60*1e3;if(!l[a])l[a]={gameEle:[],games:[],gameDate:a,disDate:e.formatTime(o,"yyyy-MM-dd"),startWeek:s.getWeek(o),endWeek:s.getWeek(i),saleGameSize:0};var c=e.template(r,{playType:h,data:n,isCurrent:B});if("1"==n.status)l[a].saleGameSize+=1;l[a].gameEle.push(e(c));l[a].games.push(n)}});f.html(e.template(l,{attentionSize:T}));m=f.find(".attention");u=f.find(".unAttention");for(C in y){d="attention"==C?m:u;g=y[C];b=o.getMapKeyList(g);b.sort(function(e,t){return+e-+t});e.each(b,function(t,n){v=g[n];if(!v.games||!v.games.length)return;S=e.template(c,{gameDate:v.gameDate,disDate:v.disDate,startWeek:v.startWeek,endWeek:v.endWeek,saleGameSize:v.saleGameSize});S=e(S);e.each(v.games,function(t,n){O=v.gameEle[t].find(a.oneOptionSelect);I={};O.each(function(t,n){var o=e(this),i=o.attr(a.oneOptionGameType),s=o.attr(a.oneOptionIndex);if(i&&s>=0){I[i]=I[i]||{};if(I[i][s])I[i][s]=I[i][s].add(o);else I[i][s]=o}});o.addOneMatch(e.extend({},n,{wrap:S,ele:v.gameEle[t],optionMap:I}));S.append(v.gameEle[t])});d.append(S)})}n.trigger("onRender")};g();delete this.renderHTML;return this}},h=function(){var t=this.betArea,n=this,a={},o=this.config,i,s=null,l=this.cache.moreOptionTpl;if(!l||!l.length)return this;l=l.html();i={};var c=function(e){var n;if(e&&a[e])if(a[e].hasClass("closeBtn"))a[e].html('隐藏<i class="arrow"><i>◇</i></i>');else{n=t.getOneSelectGameInfo(e);if(n&&n["sfc"]&&a[e].hasClass("openBtnSele"))a[e].html("已选"+n["sfc"].length+'项<i class="arrow"><i>◇</i></i>');else a[e].html('胜分差<i class="arrow"><i>◇</i></i>')}},r=function(e,t){var n;if(e){n=e.matchCode;if(t){if(a[n])delete a[n];if(i[n])delete i[n]}else a[n]=e.ele.find(".openBtn[matchCode]")}},h=function(){if(s)if(i[s]&&a[s]){i[s].hide();a[s].removeClass("closeBtn").parents("span").css("position","");c(s);s=null}},f=function(n){var a=e(this),r,f,d={},m=a.attr("matchCode"),u,p;n.stopPropagation();if(m)if(a.hasClass("closeBtn")){if(i[m])i[m].hide();a.removeClass("closeBtn").parents("span").css("position","");c(m);s=null}else{p=t.getOneGameInfo(m);u=t.getOneSelectGameInfo(m);if(p){h();a.addClass("closeBtn").parents("span").css("position","relative");s=m;c(m);if(i[m])i[m].show();else{r=e(e.template(l,{gameInfo:p,oneSelGameInfo:u,playType:t.config.playType}));f=r.find(o.oneOptionSelect);f.each(function(){var t=e(this),n=t.attr("index");d[n]=t});t.updateOptionMap(m,"sfc",d);a.after(r).show();i[m]=r}}}},d=function(t){var n=e(this);if("mouseover"==t.type)n.addClass("hover");else n.removeClass("hover")},m=function(){h()};t.eachGameInfo(function(e,t){r(t)});this.cache.gameWrap.delegate(".openBtn[matchCode]","click",f).delegate(".openBtn[matchCode]","mouseenter mouseleave",d).delegate(".analyMore","click",e.stopProp);t.onAddGame(function(e,t){r(t)});t.onBeforeDelGame(function(e,t){r(t,true)});t.onBeforeDestory(function(){n.cache.gameWrap.undelegate(".openBtn[matchCode]","click",f).undelegate(".openBtn[matchCode]","mouseenter mouseleave",d).undelegate(".analyMore","click",e.stopProp);e(document).unbind("click",m);s=null;a={};i={}});t.onChange(function(e){if(e){var n=t.getOneSelectGameInfo(e);if(n&&n["sfc"]&&a[e])a[e].addClass("openBtnSele");else a[e].removeClass("openBtnSele");c(e)}});t.onClear(function(t){e.each(t,function(){if(a[this])a[this].removeClass("openBtnSele");c(this)})});e(document).click(m)},f=function(n,a,o){var i=t;n.onDel(function(e){a.del(e)}).onSelectOption(function(e,t,n,o,i){var s=this.cache.gameInfo,l=s[e];if(!l)return;a.selectOption(e,t,n,o,l.matchnumcn,l.hostName,l.guestName,l.score)}).onRemoveOption(function(e,t,n,o){var i=this.cache.gameInfo,s=i[e];if(!s)return;a.removeOption(e,t,n,s.matchnumcn,s.hostName,s.guestName,s.score)}).onClear(function(){a.clear()}).onChange(function(){i.dan(a,o)});n.attentionView.onSave(function(n){var a=t.cache.matchList;n=n||{};e.each(a,function(e,t){if(n[t.leagueId])t.isAttention=n[t.leagueId].isAttention})})},d=function(e,n,a){var o=t;n.onChange(function(n,s,c,r){var h,f,d=this.get(),m=e.getGameInfo();h=o.getMaxMethod(d);f=o.getMinMethod(t.config.playType);if(d.length)o.cache.poolStep1.addClass("select").removeClass("unselect");else o.cache.poolStep1.removeClass("select").addClass("unselect");if(d.length>=f)o.cache.poolStep2.addClass("select").removeClass("unselect");else o.cache.poolStep2.removeClass("select").addClass("unselect");if(d.length<3)a.setActiveTab(0);a.changeMethod(h,f);if(d.length&&d.length<=2&&d.length>=f){a.setMethod([]);a.setMethod([d.length+"_1"])}if(3==d.length)if(a.cache.selectMethod.toString().indexOf("1_1")>=0)a.setMethod(["1_1"]);else a.setMethod([]);i.updateGameInfo();i.messageTip();l.reSetRightSideHeight&&l.reSetRightSideHeight();i.moveOptionAnimation(n,s,c,r)}).onRemoveOption(function(t,n,a,o,i){e.removeOption(t,n,a)}).onClear(function(){e.clear()}).onDel(function(t){e.del(t)}).onChangeDan(function(){o.dan(n,a);i.updateGameInfo()})},m=function(e,n,a){var o=t;a.onMethodChange(function(e){var t=this.get();o.dan(n,a);i.updateGameInfo();if(t&&t.selectMethod.length){o.cache.poolStep3.addClass("select").removeClass("unselect");i.messageTip()}else o.cache.poolStep3.removeClass("select").addClass("unselect")}).onTabChange(function(){"m_n"==this.cache.currentType&&n.setDisableDan(true)&&a.setDisabledMethod(false);i.messageTip()})};c=Class.Game.COMS.JC.BetView.extend(r)}(jQuery,Core,Game,window);